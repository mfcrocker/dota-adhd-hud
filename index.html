<html>
    <head>
        <link rel="stylesheet" type="text/css" href="index.css">
    </head>
    <body>
        <p><button id="start">Start Capture</button>&nbsp;<button id="stop">Stop Capture</button></p>
        <div class="outer-wrapper">
            <div class="minimap">
                <video id="minimap" height="1440px" width="2560px" autoplay></video>
            </div>

            <div class="inner-wrapper">
                <div class="clock">
                    <video id="clock" height="1440px" width="2560px" autoplay></video>
                </div>
                
                <div class="skills">
                    <video id="skills" height="1440px" width="2560px" autoplay></video>
                </div>
            </div>
    
            <div class="items">
                <video id="items" height="1440px" width="2560px" autoplay></video>
            </div>
        </div>

        <!-- Largely lifted and adapted from the Mozilla tutorial at https://developer.mozilla.org/en-US/docs/Web/API/Screen_Capture_API/Using_Screen_Capture -->
        <script>
            const minimapElem = document.getElementById("minimap");
            const skillsElem = document.getElementById("skills");
            const itemsElem = document.getElementById("items");
            const clockElem = document.getElementById("clock");
            const startElem = document.getElementById("start");
            const stopElem = document.getElementById("stop");

            // Options for getDisplayMedia()

            var displayMediaOptions = {
                video: {
                    cursor: "always"
                },
                audio: false
            };

            // Set event listeners for the start and stop buttons
            startElem.addEventListener("click", function(evt) {
                startCapture();
            }, false);

            stopElem.addEventListener("click", function(evt) {
                stopCapture();
            }, false);

            async function startCapture() {
                try {
                    let capture = await navigator.mediaDevices.getDisplayMedia(displayMediaOptions);
                    minimapElem.srcObject = capture;
                    skillsElem.srcObject = capture;
                    itemsElem.srcObject = capture;
                    clockElem.srcObject = capture;
                } catch(err) {
                    console.error("Error: " + err);
                }
            }

            function stopCapture(evt) {
                let capturetracks = minimapElem.srcObject.getTracks();
                capturetracks.forEach(track => track.stop());
                minimapElem.srcObject = null;

                let skillstracks = skillsElem.srcObject.getTracks();
                skillstracks.forEach(track => track.stop());
                skillsElem.srcObject = null;

                let itemstracks = itemsElem.srcObject.getTracks();
                itemstracks.forEach(track => track.stop());
                itemsElem.srcObject = null;

                let clocktracks = clockElem.srcObject.getTracks();
                clocktracks.forEach(track => track.stop());
                clockElem.srcObject = null;
            }
        </script>
    </body>
</html>